@page "/proyects"

@using ZetaDashboard.Common.ZDB.Models

<PageTitle>Proyectos - ZetaDashboard</PageTitle>

<!-- #region Title -->
<div style="display:flex;align-items:center;justify-content:space-between">
    <div></div>
    <div>
        <h2>🛠️ Proyectos</h2>
    </div>
    <div style="padding-right:30px;">
        @if (CService.CheckIfPermissions(LoggedUser,ThisPageEdit))
        {
            <MudTooltip Text="Insertar proyecto">
                <MudIconButton 
                    Variant="Variant.Filled" 
                    Icon="@Icons.Material.Filled.Add" 
                    Size="Size.Large" 
                    Color="Color.Primary"
                               OnClick="@OnOpenInsertModal"></MudIconButton>
            </MudTooltip>
        }
    </div>
</div>
<!-- #endregion -->

<!-- #region Insert Modal -->
<MudDialog @bind-Visible="InsertModal" Class="dialog-modal-custom">
    <TitleContent>
        <div style="display:flex;align-items:center;justify-content:space-between;">
            <div></div>
            <div style="display:flex;align-items:center;">
                <MudIcon
                    Icon="@Icons.Material.Filled.AddCircle"
                    >
                </MudIcon>
                <h3 style="margin-left:10px">Insertar Proyecto</h3>
            </div>
            <div>
                <MudIconButton
                    Icon="@Icons.Material.Filled.Close"
                    Variant="Variant.Filled"
                    Color="Color.Error"
                    OnClick="@(() => InsertModal = false)">
                </MudIconButton>
            </div>
        </div>
    </TitleContent>
    <DialogContent>
        <EditForm Model="InsertModel" OnValidSubmit="OnInsertData">
            <div style="margin-top:25px;">
                <MudTextField 
                    @bind-Value="InsertModel.Code" 
                    Immediate="true" 
                    MaxLength="3"
                    Label="Codigo" 
                    Required="true"
                    >
                </MudTextField>
            </div>
            <div style="margin-top:25px;">
                <MudTextField @bind-Value="InsertModel.Icon"
                              Immediate="true"
                              
                              Label="Icono"
                              Required="true"
                              >
                </MudTextField>
            </div>
            <div style="margin-top:25px;">
                <MudTextField 
                    @bind-Value="InsertModel.Name" 
                    Immediate="true" 
                    Label="Nombre" 
                    Required="true"
                    >
                </MudTextField>
            </div>
            <div style="margin-top:25px;">
                <MudText > @($"{InsertModel.Code}-{InsertModel.Name}")</MudText>
            </div>
            <div style="margin-top:25px;">
                <MudTextField @bind-Value="InsertModel.Url" Label="Url" ></MudTextField>
            </div>
            
            <div style="display:flex;justify-content:center;">
                <div style="display:flex;justify-content:space-around;width:70%">
                    <MudButton ButtonType="ButtonType.Submit" Color="Color.Primary"  Variant="Variant.Filled">Aceptar</MudButton>
                    <MudButton Color="Color.Error" Style="margin-top:25px;" Variant="Variant.Filled" OnClick="@(() => InsertModal = false)">Cerrar</MudButton>
                </div>
            </div>
        </EditForm>
    </DialogContent>
</MudDialog>
<!-- #endregion -->

<!-- #region Update Modal -->
<MudDialog @bind-Visible="UpdateModal" Class="dialog-modal-custom">
    <TitleContent>
        <div style="display:flex;align-items:center;justify-content:space-between;">
            <div></div>
            <div style="display:flex;align-items:center;">
                <MudIcon Icon="@Icons.Material.Filled.Edit">
                </MudIcon>
                <h3 style="margin-left:10px">Editar @UpdateModel.FullName Proyecto</h3>
            </div>
            <div>
                <MudIconButton Icon="@Icons.Material.Filled.Close"
                               Variant="Variant.Filled"
                               Color="Color.Error"
                               OnClick="@(() => UpdateModal = false)">
                </MudIconButton>
            </div>
        </div>
    </TitleContent>
    <DialogContent>
        <EditForm Model="UpdateModel" OnValidSubmit="OnUpdateData">
            <div style="margin-top:25px;">
                <MudTextField @bind-Value="UpdateModel.Code"
                              Immediate="true"
                              MaxLength="3"
                              Label="Codigo"
                              Required="true"
                              >
                </MudTextField>
            </div>
            <div style="margin-top:25px;">
                <MudTextField @bind-Value="UpdateModel.Icon"
                              Immediate="true"
                              
                              Label="Icono"
                              Required="true"
                              ></MudTextField>
            </div>
            <div style="margin-top:25px;">
                <MudTextField @bind-Value="UpdateModel.Name"
                              Immediate="true"
                              Label="Nombre"
                              Required="true"
                              >
                </MudTextField>
            </div>
            <div style="margin-top:25px;">
                <MudText > @($"{UpdateModel.Code}-{UpdateModel.Name}")</MudText>
            </div>
            <div style="margin-top:25px;">
                <MudTextField @bind-Value="UpdateModel.Url" Label="Url" ></MudTextField>
            </div>

            <div style="display:flex;justify-content:center;">
                <div style="display:flex;justify-content:space-around;width:70%">
                    <MudButton ButtonType="ButtonType.Submit" Color="Color.Primary" Style="margin-top:25px;" Variant="Variant.Filled">Aceptar</MudButton>
                    <MudButton Color="Color.Error" Style="margin-top:25px;" Variant="Variant.Filled" OnClick="@(() => UpdateModal = false)">Cerrar</MudButton>
                </div>
            </div>
        </EditForm>
    </DialogContent>
</MudDialog>
<!-- #endregion -->

<!-- #region DataGrid -->
<MudPaper Style="margin-top:20px;" Elevation="0">
    <MudDataGrid Items="@DataList" T="ProyectModel" Filterable="true" QuickFilter="_quickFilter" Hideable="true">
        <ToolBarContent>
            <MudText Typo="Typo.h6"></MudText>
            <MudSpacer />
            <MudTextField @bind-Value="_searchString" Placeholder="Search" Adornment="Adornment.Start" Immediate="true"
                          AdornmentIcon="@Icons.Material.Filled.Search" Clearable="true" IconSize="Size.Medium" Class="mt-0"></MudTextField>
        </ToolBarContent>
        <Columns>
            <TemplateColumn>
                <CellTemplate>
                    <MudTooltip Text="@(context.Item.Id)">
                        <MudIcon 
                            Icon="@Icons.Material.Filled.Info">
                        </MudIcon>
                    </MudTooltip>
                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Property="x => x.Code" Title="Codigo" />
            <TemplateColumn>
                <CellTemplate>
                    <MudText>
                        @context.Item.Icon
                    </MudText>
                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Property="x => x.Name" Title="Nombre" />
            <PropertyColumn Property="x => x.FullName" Title="Nombre Completo" />
            <PropertyColumn Property="x => x.Url" Title="Direccion" />
            @if (CService.CheckIfPermissions(LoggedUser, ThisPageEdit))
            {
                <TemplateColumn CellClass="d-flex justify-end" Title="Acciones">
                    <CellTemplate>
                        <MudStack Row style="width:100%">
                            <div class="modal-buttons-actions">
                                <MudTooltip Text="@($"Editar proyecto {context.Item.Name}")">
                                    <MudIconButton  Variant="@Variant.Filled"
                                                Color="@Color.Primary"
                                                   OnClick="@(() => OnOpenUpdateModal(context.Item))"
                                                Icon="@Icons.Material.Filled.Edit"></MudIconButton>
                                </MudTooltip>

                                @if (CService.CheckIfPermissions(LoggedUser, ThisPageAdmin))
                                {
                                    <MudTooltip Text="@($"Borrar proyecto {context.Item.Name}")">
                                        <MudIconButton Variant="@Variant.Filled"
                                        Style="margin-left:7px;" 
                                        OnClick="@(() => OnOpenDeleteModal(context.Item))"
                                        Color="@Color.Error"
                                        Icon="@Icons.Material.Filled.Delete">
                                        </MudIconButton>
                                    </MudTooltip>
                                }
                            </div>
                        </MudStack>
                    </CellTemplate>
                </TemplateColumn>
            }
        </Columns>
        <PagerContent>
            <MudDataGridPager T="ProyectModel" />
        </PagerContent>
    </MudDataGrid>
</MudPaper>
<!-- #endregion -->
