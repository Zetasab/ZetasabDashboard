@page "/search-movie"
@using ZetaDashboard.Data.MOV


<!-- #region Title -->
<div style="display:flex;align-items:center;justify-content:space-between">
    <div></div>
    <div>
        <h2>🧗🏻‍ Planes</h2>
    </div>
    <div style="padding-right:30px;">
    </div>
</div>
<!-- #endregion -->
<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudGrid>
        <MudItem xs="@((int)12)" md="@((int)2)">
            <MudExpansionPanels MultiExpansion="true" >
                <MudExpansionPanel Text="Ordenar">
                    Ordenar
                </MudExpansionPanel>
                <MudExpansionPanel Text="Donde ver">
                    <MudGrid>
                        @foreach (var item in MovieData.WhatProviders)
                        {
                            <MudItem Class="whatprovider">
                                <img src="@($"https://image.tmdb.org/t/p/w300{item.Logo_path}")" loading="lazy" />
                            </MudItem>
                        }
                    </MudGrid>
                </MudExpansionPanel>
                <MudExpansionPanel Text="Filtros" Expanded="true">
                    Filtros
                </MudExpansionPanel>
            
            </MudExpansionPanels>
        </MudItem>
        <MudItem xs="@((int)12)" md="@((int)10)">
            
                <MudGrid Style="padding:15px 30px;">
                    @if (DataList is null)
                    {
                        <MudItem xs="@((int)12)">
                            <MudText Typo="Typo.h6">Loading movies...</MudText>
                        </MudItem>
                    }
                    else
                    {
                        @foreach (var movie in DataList)
                        {
                            <MudItem xs="@((int)12)" sm="@((int)6)" lg="@((int)3)">
                                <MudPaper Class="movie-card" Elevation="3">
                                    <div class="movie-backdrop">
                                        <img style="width:100%;height:100%;object-fit:cover; object-position:center;"
                                             src="@movie.GetBackdropUrl("w500")" loading="lazy" />
                                        <div class="movie-overlay">
                                            <MudText Typo="Typo.h6" Class="movie-title">@movie.Title</MudText>

                                            <!-- círculo de valoración -->
                                            <div class="movie-score">
                                                <MudProgressCircular Size="Size.Medium"
                                                                     Value="@(movie.VoteAverage * 10)"
                                                                     Color="@GetScoreColor(movie.VoteAverage)"
                                                                     StrokeWidth="6" />
                                                <span class="movie-score-text">@((int)(movie.VoteAverage * 10))</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="movie-actions">
                                        <MudIconButton Icon="@Icons.Material.Filled.FavoriteBorder"
                                                       Color="Color.Primary"
                                                       Size="Size.Small" />
                                        <MudIconButton Icon="@Icons.Material.Filled.Visibility"
                                                       Color="Color.Success"
                                                       Size="Size.Small" />
                                    </div>
                                </MudPaper>
                            </MudItem>

                        }
                        <MudItem xs="@((int)12)" Style="display:flex;justify-content:center;">
                            <MudButton Variant="Variant.Filled" OnClick="LoadMore" Color="Color.Primary">Cargar mas</MudButton>
                        </MudItem>
                    }
                </MudGrid>
            
        </MudItem>
    </MudGrid>
</MudContainer>

<style>
    .movie-card {
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        height: 260px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: transform 0.2s ease-in-out;
    }

        .movie-card:hover {
            transform: scale(1.03);
        }

    .movie-backdrop {
        flex: 1;
        background-size: cover;
        background-position: center;
        position: relative;
    }

    .movie-overlay {
        position: absolute;
        bottom: 0px; /* dejamos hueco para botones */
        width: 100%;
        padding: 12px;
        background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0));
        display:flex;
        justify-content:space-between;
        align-items:center;
    }

    .movie-title {
        color: white;
        font-weight: bold;
        text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }

    /* barra de acciones al fondo */
    .movie-actions {
        display: flex;
        justify-content: space-around;
        background: rgba(0, 0, 0, 0.6);
        padding: 6px;
    }

    .movie-score {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-top: 8px;
    }

    .movie-score-text {
        position: absolute;
        font-size: 14px;
        font-weight: bold;
        color: white;
    }

    .whatprovider{
        width:75px;
        height:75px;
    }

    .whatprovider img{
        width:100%;
        height:100%;
        object-fit:cover;
    }
    </style>