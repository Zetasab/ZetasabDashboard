@using System.Globalization
<div class="movie-grid-item">
    <MudPaper Class="movie-card" Elevation="3">
        <!-- your existing card -->
        <div class="movie-backdrop" @onclick="@(() => ShowMovie(movie.Id.ToString()))">
            <div class="movie-container-date">
                @if (!string.IsNullOrEmpty(movie.ReleaseDate))
                {  
                    <text>
                        📅 @DateTime.ParseExact(movie.ReleaseDate, "yyyy-MM-dd", CultureInfo.InvariantCulture).ToString("dd MMM yyyy", new CultureInfo("es-ES"))
                    </text>
                }
            </div>
            <img style="width:250px;height:375px;object-fit:cover;object-position:center;"
                 src="@movie.GetPosterUrl("w500")" onload="lazy" onerror="this.onerror=null; this.src='https://static.vecteezy.com/system/resources/previews/004/141/669/non_2x/no-photo-or-blank-image-icon-loading-images-or-missing-image-mark-image-not-available-or-image-coming-soon-sign-simple-nature-silhouette-in-frame-isolated-illustration-vector.jpg';" loading="lazy" />
            <div class="movie-overlay">
                <MudText Typo="Typo.h6" Class="movie-title">@movie.Title</MudText>
                <div class="movie-score">
                    <MudProgressCircular Size="Size.Medium"
                                         Value="@(movie.VoteAverage * 10)"
                                         Color="@GetScoreColor(movie.VoteAverage)"
                                         StrokeWidth="6" />
                    <span class="movie-score-text">@((int)(movie.VoteAverage * 10))</span>
                </div>
            </div>
        </div>
        <div class="movie-actions">
            @if (ShowButtons)
            {
                @if (CService.CheckIfPermissions(LoggedUser, ThisPageEdit))
                {
                    <!-- Visto -->
                    @if (SeenMovies.Any(x => x.Title == movie.Title))
                    {
                        <MudTooltip Text="Desmarcar como visto">
                            <MudIconButton Icon="@Icons.Material.Filled.Visibility"
                                           Color="Color.Success"
                                           OnClick="@(() => UnMarkAsSeen(movie))" />
                        </MudTooltip>
                    }
                    else
                    {
                         <MudTooltip Text="Marcar como visto">
                            <MudIconButton Icon="@Icons.Material.Outlined.Visibility"
                                           Color="Color.Success"
                                           OnClick="@(() => MarkAsSeen(movie))" />
                        </MudTooltip>
                    }


                    <!-- Añadir a favoritos -->
                    @if (LikedMovies.Any(x => x.Title == movie.Title))
                    {
                        <MudTooltip Text="Quitar de Favoritos">
                            <MudIconButton Icon="@Icons.Material.Filled.Favorite"
                                           Color="Color.Secondary"
                                           OnClick="@(() => UnMarkAsLiked(movie))" />
                        </MudTooltip>
                    }
                    else
                    {
                        <MudTooltip Text="Añadir a Favoritos">
                            <MudIconButton Icon="@Icons.Material.Outlined.FavoriteBorder"
                                           Color="Color.Secondary"
                                           OnClick="@(() => MarkAsLiked(movie))" />
                        </MudTooltip>
                    }          

                    <!-- Watchlist -->
                    @if (WatchMovies.Any(x => x.Title == movie.Title))
                    {
                        <MudTooltip Text="Quitar de ver mas tarde">
                            <MudIconButton Icon="@Icons.Material.Filled.Bookmark"
                                           Color="Color.Primary"
                                           OnClick="@(() => UnMarkAsWatch(movie))" />
                        </MudTooltip>
                    }
                    else
                    {
                        <MudTooltip Text="Añadir a ver mas tarde">
                            <MudIconButton Icon="@Icons.Material.Outlined.BookmarkBorder"
                                           Color="Color.Primary"
                                           OnClick="@(() => MarkAsWatch(movie))" />
                        </MudTooltip>
                    }
                }
            }

            

        </div>
    </MudPaper>
</div>